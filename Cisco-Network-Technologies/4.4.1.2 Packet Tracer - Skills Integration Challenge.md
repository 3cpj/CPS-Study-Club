# 4.4.1.2 Packet Tracer - Skills Integration Challenge
![](/images/4.4.1.2%20Packet%20Tracer-1.png)
![](/images/4.4.1.2%20Packet%20Tracer-q-1-1.png)


# 先設定Router 1(R1):
![](/images/4.4.1.2%20Packet%20Tracer-q-1.png)
根據題目所給的addressing Table，我們知到要設定G0/0和開始VLAN 99、10、20

當有不同VLAN但只能他們只能通過一個Router時，就要使用一種技巧 — 單臂路由(router-on-a-stick)

在圖中可看見我們要在Router一個物理接口上接受多個LAN(VLAN)，因此就要為Router 的G0/0介面上設定多個“邏輯子接口”。

邏輯子接口的概念：路由器的物理接口可以被劃分成多個邏輯接口（或者認為是虛接口），這些被劃分後的邏輯接口被形象的稱為子接口。值得注意的是這些邏輯子接口不能被單獨的開啟或關閉，也就是說，當物理接口被開啟或關閉時，所有的該接口的子接口也隨之被開啟或關閉。

邏輯子接口會被表示為 G0/0.1、G0/0.2、G0/0.3。在原本的 物理接口 後加上$[$點$]$+$[$邏輯子接口編號$]$

所以我們先要開啟 物理接 G0/0 之後才 設定 G0/0.1、G0/0.10、...

## R1 command
```cisc
en
conf t
! 開啟G0/0介面
int g0/0
no sh

!進入邏輯子接口
int g0/0.1
!根據要求把這個邏輯子接口設定指定封裝協議 和 VLAN ID
encap dot1q 99 native
!指派IP 給這個邏輯子接口
ip add 192.168.99.1 255.255.255.0
! 開啟G0/0.1介面
no sh 

!下一個邏輯子接口根據表同上設定
int g0/0.10
encap dot1q 10
ip add 192.168.10.1 255.255.255.0
no sh

!再下一個邏輯子接口根據表同上設定
int g0/0.20
encap dot1q 20
ip add 192.168.20.1 255.255.255.0
no sh
```
--- 
RIP 是一種路由協議，RIP路由協定屬於動態路由

先啟用RIP，通常使用RIP的第二個版本(版本1己過時)，之後把要參與RIP路由的網段加入network

我們要把 g0/0.1 g0/0.10 g0/0.20 設定成passive mode

> ## 為什麼?
> 接口开始往外发送路由数据包，尝试和对端设备建立邻居关系或直接交换路由。但是如果接口对端接的是PC或者二层交换机，则并不需要也不能理解动态路由协议产生的一些数据包。在这种情况下，为了使接口不在链路上发送不必要的路由数据包，产生不必要的流量，同时也为了减轻端口对端设备的不必要负担，就可以将那个接口设置为被动接口。
>
>版权声明：本文为CSDN博主「剑髯202000」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：https://blog.csdn.net/wucl202000/article/details/36716479

## default-information originate 設定缺省路由(默认路由)
用作默認路由，表示”任意IPV4主機”。
> 即敲下这条命令之后，这个路由器会通过路由协议告诉它的邻居，它有一条缺省路由，然后它的邻居就会产生一条指向这个路由器的缺省路由条目，所有发往未知网络的数据包都会发送给通告这条命令的路由器

## auto-summary - 彙總到主類邊界
主类指A.B.C类IP地址，
| 分类 |前缀码|	开始地址  |	   结束地址   |	对应CIDR修饰|	默认子网掩码|
|:----:|:---:|:---------:|:---------------:|:--:|:------------:|
|A类地址|	 0|   0.0.0.0|	127.255.255.255	|/8 |	  255.0.0.0|
|B类地址| 	10|	128.0.0.0|	191.255.255.255	|/16| 	255.255.0.0|
|C类地址|  110| 192.0.0.0|	223.255.255.255	|/24|255.255.255.0 |

> R1现在有一条10.1.1.2/24的路由，如果在RIPv2版本中开启了no auto-summary，那么RIPv2在传输这条路由的时候就会为10.1.1.0/24传出去。<br>
>如果没有关闭auto-summary，那么就会以10.0.0.0/8的路由形式传出去。<br>
>一般都建議no auto-summary，因爲這樣可以實現精確查找。
https://www.twblogs.net/a/5b96d84d2b717750bda6a016
## R1 command:continue
```cisc
!啟用RIP
router rip
    !設定rip 的版本
    version 2
    !添加參與RIP的網段
    network 192.168.99.0
    network 192.168.10.0
    network 192.168.20.0
    network 192.168.1.0

    !把不需要理解路由的設備port口設定成passive mode
    passive g0/0.1
    passive g0/0.10
    passive g0/0.20
    !設定缺省路由
    default ori
    !關閉自動彙總主類邊界
    no auto-summary

    exit

```


# 同樣地設定Router 2(R2):

## R2 command
```cisc
en
conf t
! 開啟G0/0介面
int g0/0
no sh

!進入邏輯子接口
int g0/0.1
encap dot1q 99 native
ip add 192.168.99.2 255.255.255.0
no sh 

!下一個邏輯子接口根據表同上設定
int g0/0.10
encap dot1q 10 
ip add 192.168.10.2 255.255.255.0
no sh

!再下一個邏輯子接口根據表同上設定
int g0/0.20
encap dot1q 20 
ip add 192.168.20.2 255.255.255.0
no sh

!啟用RIP
router rip
    version 2
    network 192.168.99.0
    network 192.168.10.0
    network 192.168.20.0
    network 192.168.1.0

    passive g0/0.1
    passive g0/0.10
    passive g0/0.20

    !設定缺省路由
    default ori
    !關閉自動彙總主類邊界
    no auto-summary

    exit
```


# 開始設定Switch 1(s1):
![](/images/4.4.1.2%20Packet%20Tracer-q-2.png)
根據題目要求我們要把S1 設定成VTP server

### VTP
VTP 主要用來管理VLAN，只要把一個swich 設成server，其他設成client，那麼我們只要在server switch中設定VLAN，其他client switch就會自動同步VLAN，我們就不用在其他client switch中再設定多次VLAN。

同一個VTP中要設同一樣的 domain 和 password 
## Switch 1
```cisc
en
conf t

! 把switch 設成VTP server
vtp mode server
    ! 設同一樣的 domain 和 password 
    vtp domain CCNA
    vtp password cisco123

!創建Vlan
vlan 99 
vlan 10
vlan 20
exit

! 進入interface
int range f0/1-9
    ! 把port口設成access mode
    sw mo acc
    ! 把指定port口 分配給 指定 VLAN
    sw ac vlan 10

int range f0/10-19
    sw mo acc
    sw ac vlan 20

int range f0/20-24, g0/1-2
    ! 把port口設成trunk mode
    sw mo trunk 
    sw trunk native vlan 99
```
## ether-channel
把多於一條的物理線路合併成一條邏輯線路。這可以提高頻寬和可用性。
一般會說把這兩條線bunch在一起。



![](/images/4.4.1.2%20Packet%20Tracer-q-3.png)
## Switch 1:continue
```cisc
! 進入把要bunch的port range
int range g0/1-2
    !把他們bunch在一起，給一個編號 1，mode 設成active
    channel-group 1 mode active
! 設定這一束線(bundle)的VLNA，以bundle的編號進入
int po 1
    sw mode trunk
    sw trunk native vlan 99

! 進入把要bunch的port range
int range f0/23-24
    ! 把他們bunch在一起，給一個編號 3，mode 設成active
    channel-group 3 mode active
! 設定這一束線(bundle)的VLNA，以bundle的編號進入
int po 3
    sw mode trunk
    sw trunk native vlan 99
    

! 進入把要bunch的port range
int range f0/21-22
    ! 把他們bunch在一起，給一個編號 5，mode 設成active
    channel-group 5 mode active
int po 5
    sw mode trunk
    sw trunk native vlan 99

```

### rstp
STP 是在switch中的一種算法。生成樹算法是為了防止Switching loop。

priority 較小者優先成為root switch 和 designated port，以下設定確保vlan 10 優先走S1， Vlan 20優先走S2 ，同時package不會回流到S3、S4

![](/images/4.4.1.2%20Packet%20Tracer-q-4.png)
在要求中我們要用RSTP(快速生成樹算法)

## Switch 1:continue 2
```cisco
!改用RSTP
spanning-tree mode rap
!根據要求設定不同Vlan 的priority
spanning-tree vlan 10 priority 4096
spanning-tree vlan 20 priority 8192

```


# 同一方法設定Switch 2(s2)
## Switch 2
```cisco
en
conf t

! 把switch 設成VTP client
vtp mode client
    ! 設同一樣的 domain 和 password 
    vtp domain CCNA
    vtp password cisco123

!創建Vlan
vlan 99 
vlan 10
vlan 20

int range f0/1-9
    sw mo acc
    sw ac vlan 10

int range f0/10-19
    sw mo acc
    sw ac vlan 20

int range f0/20-24, g0/1-2
    sw mo trunk 
    sw trunk native vlan 99
```
## Switch 2:continue
```cisco
! 進入把要bunch的port range
int range g0/1-2
    !把他們bunch在一起，給一個編號 2，mode 設成active
    channel-group 2 mode active
! 設定這一束線(bundle)的VLNA，以bundle的編號進入
int po 2
    sw mode trunk
    sw trunk native vlan 99

! 進入把要bunch的port range
int range f0/21-22
    ! 把他們bunch在一起，給一個編號 6，mode 設成active
    channel-group 6 mode active
! 設定這一束線(bundle)的VLNA，以bundle的編號進入
int po 6
    sw mode trunk
    sw trunk native vlan 99
    

! 進入把要bunch的port range
int range f0/23-24
    ! 把他們bunch在一起，給一個編號 3，mode 設成active
    channel-group 3 mode active
int po 3
    sw mode trunk
    sw trunk native vlan 99
```
## Switch 2:continue 2
```cisco
!改用RSTP
spanning-tree mode rap
!根據要求設定不同Vlan 的priority
spanning-tree vlan 10 priority 8192
spanning-tree vlan 20 priority 4096

```



# 同一方法設定Switch 3(s3)
## Switch 3
```cisco
en
conf t

! 把switch 設成VTP client
vtp mode client
    ! 設同一樣的 domain 和 password 
    vtp domain CCNA
    vtp password cisco123

!創建Vlan
vlan 99 
vlan 10
vlan 20

int range f0/1-9
    sw mo acc
    sw ac vlan 10

int range f0/10-19
    sw mo acc
    sw ac vlan 20

int range f0/20-24, g0/1-2
    sw mo trunk 
    sw trunk native vlan 99
```
## Switch 3:continue
```cisco
! 進入把要bunch的port range
int range f0/23-24
    !把他們bunch在一起，給一個編號 4，mode 設成active
    channel-group 4 mode active
! 設定這一束線(bundle)的VLNA，以bundle的編號進入
int po 4
    sw mode trunk
    sw trunk native vlan 99

! 進入把要bunch的port range
int range g0/1-2
    ! 把他們bunch在一起，給一個編號 1，mode 設成active
    channel-group 1 mode active
! 設定這一束線(bundle)的VLNA，以bundle的編號進入
int po 1
    sw mode trunk
    sw trunk native vlan 99
    

! 進入把要bunch的port range
int range f0/21-22
    ! 把他們bunch在一起，給一個編號 6，mode 設成active
    channel-group 6 mode active
int po 6
    sw mode trunk
    sw trunk native vlan 99
```
## Switch 3:continue 2
```cisco
!改用RSTP
spanning-tree mode rap
!根據要求設定不同Vlan 的priority
spanning-tree vlan 10 priority 32768
spanning-tree vlan 20 priority 32768
```



# 同一方法設定Switch 4(s4)
## Switch 4
```cisco
en
conf t

! 把switch 設成VTP client
vtp mode client
    ! 設同一樣的 domain 和 password 
    vtp domain CCNA
    vtp password cisco123

!創建Vlan
vlan 99 
vlan 10
vlan 20

int range f0/1-9
    sw mo acc
    sw ac vlan 10

int range f0/10-19
    sw mo acc
    sw ac vlan 20

int range f0/20-24, g0/1-2
    sw mo trunk 
    sw trunk native vlan 99
```
## Switch 4:continue
```cisco
! 進入把要bunch的port range
int range g0/1-2
    !把他們bunch在一起，給一個編號 2，mode 設成active
    channel-group 2 mode active
! 設定這一束線(bundle)的VLNA，以bundle的編號進入
int po 2
    sw mode trunk
    sw trunk native vlan 99

! 進入把要bunch的port range
int range f0/23-24
    ! 把他們bunch在一起，給一個編號 4，mode 設成active
    channel-group 4 mode active
! 設定這一束線(bundle)的VLNA，以bundle的編號進入
int po 4
    sw mode trunk
    sw trunk native vlan 99
    

! 進入把要bunch的port range
int range f0/21-22
    ! 把他們bunch在一起，給一個編號 5，mode 設成active
    channel-group 5 mode active
int po 5
    sw mode trunk
    sw trunk native vlan 99
```
## Switch 4:continue 2
```cisco
!改用RSTP
spanning-tree mode rap
!根據要求設定不同Vlan 的priority
spanning-tree vlan 10 priority 32768
spanning-tree vlan 20 priority 32768
```

---
小弟仍在學習中，內容和理解上可能有遺漏和錯誤。歡迎指正~

